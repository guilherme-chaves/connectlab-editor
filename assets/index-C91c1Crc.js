var de=Object.defineProperty;var ue=(s,t,e)=>t in s?de(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>ue(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();var y=(s=>(s[s.LINE=1]="LINE",s[s.NODE=2]="NODE",s[s.TEXT=3]="TEXT",s[s.SLOT=4]="SLOT",s[s.INPUT=5]="INPUT",s[s.OUTPUT=6]="OUTPUT",s))(y||{}),v=(s=>(s[s.G_AND=0]="G_AND",s[s.G_NAND=1]="G_NAND",s[s.G_NOR=2]="G_NOR",s[s.G_NOT=3]="G_NOT",s[s.G_OR=4]="G_OR",s[s.G_XNOR=5]="G_XNOR",s[s.G_XOR=6]="G_XOR",s[s.I_SWITCH=100]="I_SWITCH",s[s.O_LED_RED=200]="O_LED_RED",s))(v||{});const fe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='64'%20height='64'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20fill='none'%20stroke='%23289fac'%20stroke-linejoin='round'%20stroke-opacity='.5'%20stroke-width='.3'%3e%3cpath%20d='m0%2010.82h16'/%3e%3cpath%20d='m0%205.482h16'/%3e%3cpath%20d='m0%200.0675h16'/%3e%3cpath%20d='m10.82%200v16'/%3e%3cpath%20d='m16.06%200v16'/%3e%3cpath%20d='m0.0675%200v16'/%3e%3cpath%20d='m5.482%200v16'/%3e%3cpath%20d='m0%2016.06h16'/%3e%3c/g%3e%3c/svg%3e",ge=["connections","nodes","slots","texts"];function Zt(s){s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,s.canvas.width,s.canvas.height),s.restore()}function me(s,t){Zt(s);for(const e of ge)for(const i of t[e].values())i.draw(s)}function ve(s,t){Zt(s),s.rect(0,0,s.canvas.width,s.canvas.height),s.fillStyle=t??"#ff0000",s.fill()}const pe=s=>s[0],we=s=>s[0]&&s[1],xe=s=>!(s[0]&&s[1]),ye=s=>!(s[0]||s[1]),be=s=>!s[0],Pe=s=>s[0]||s[1],Ce=s=>s[0]===s[1],Ie=s=>s[0]!==s[1],et={input_output:pe,and:we,nand:xe,nor:ye,not:be,or:Pe,xnor:Ce,xor:Ie},ft={updateGraph(s){const t=new Set;for(const e of Object.keys(s))this.updateVertexStatus(s,parseInt(e),t);t.clear()},updateGraphPartial(s,t){var n;const e=new Set,i=[t];do e.has(i[0])||(e.add(i[0]),i.push(...((n=s[i[0]])==null?void 0:n.signalTo)??[]),i[0]!==t&&s[i[0]].nodeType!==v.I_SWITCH&&this.computeState(s,s[i[0]])),i.shift();while(i.length>0)},updateVertexStatus(s,t,e){if(e.has(t))return;e.add(t);const i=s[t];if(i!==void 0){for(let n=0;n<i.signalFrom.length;n++)this.updateVertexStatus(s,i.signalFrom[n],e);i.nodeType!==v.I_SWITCH&&this.computeState(s,i)}},computeState(s,t){var n,o;const e=this.getComputeFunction(t.nodeType),i=[!1,!1];i[0]=((n=s[t.signalFrom[0]])==null?void 0:n.state)??!1,i[1]=((o=s[t.signalFrom[1]])==null?void 0:o.state)??!1,t.state=e(i)},getComputeFunction(s){switch(s){case v.G_AND:return et.and;case v.G_NAND:return et.nand;case v.G_NOR:return et.nor;case v.G_NOT:return et.not;case v.G_OR:return et.or;case v.G_XNOR:return et.xnor;case v.G_XOR:return et.xor;default:return et.input_output}}},Pt={addVertex(s,t,e,i,n=[],o=[]){s[t]||(s[t]={state:i,signalFrom:n,signalTo:o,nodeType:e},ft.updateGraph(s))},removeVertex(s,t){var e;if(s[t]){for(const i of Object.values(s[t].signalTo)){const n=((e=s[i])==null?void 0:e.signalFrom.indexOf(t))??-1;n!==-1&&(s[i].signalFrom.splice(n,1),s[i].state=void 0)}delete s[t],ft.updateGraph(s)}},addEdge(s,t){var n,o;const e=((n=t.connectedTo.start)==null?void 0:n.nodeId)??-1,i=((o=t.connectedTo.end)==null?void 0:o.nodeId)??-1;s[e]?s[e].signalTo.find(r=>i===r)===void 0&&s[e].signalTo.push(i):console.warn(`Node inicial com ID ${i} não encontrado no grafo de sinal, isso poderá acarretar em bugs`,t),s[i]?s[i].signalFrom.push(e):console.warn(`Node final com ID ${i} não encontrado no grafo de sinal, isso poderá acarretar em bugs`,t),ft.updateGraph(s)},removeEdge(s,t){var n,o,r,l;if(t===void 0)return;const e=((n=t.connectedTo.start)==null?void 0:n.nodeId)??-1,i=((o=t.connectedTo.end)==null?void 0:o.nodeId)??-1;if(i!==-1){const h=((r=s[i])==null?void 0:r.signalFrom.indexOf(e))??-1;h!==-1&&s[i].signalFrom.splice(h,1)}if(e!==-1){const h=((l=s[e])==null?void 0:l.signalTo.indexOf(i))??-1;h!==-1&&s[e].signalTo.splice(h,1)}ft.updateGraph(s)},getVertexState(s,t){var e;return((e=s[t])==null?void 0:e.state)??!1},setVertexState(s,t,e){s[t]&&(s[t].state=e)},getVertexConnections(s,t){var e;return((e=s[t])==null?void 0:e.signalFrom)??[]}};function ke(s,t){const e=s.nodes.get(t);if(e===void 0)return!1;Pt.removeVertex(s.signalGraph,t);for(let i=0;i<e.slots.length;i++)s.removeComponent(e.slots[i].id,y.SLOT);return s.nodes.delete(t)}function Se(s,t){const e=s.slots.get(t);if(e===void 0)return!1;for(const i of Object.values(e.slotConnections))s.removeComponent(i.id,y.LINE);return s.slots.delete(t)}function Te(s,t){var o,r;const e=s.connections.get(t);if(e===void 0)return!1;const i=s.slots.get(((o=e.connectedTo.start)==null?void 0:o.slotId)??-1),n=s.slots.get(((r=e.connectedTo.end)==null?void 0:r.slotId)??-1);if(i){const l=i.slotConnections.findIndex(h=>h.id===t);l!==-1&&i.slotConnections.splice(l,1)}if(n){const l=n.slotConnections.findIndex(h=>h.id===t);l!==-1&&n.slotConnections.splice(l,1)}return Pt.removeEdge(s.signalGraph,e),s.connections.delete(t)}function Oe(s,t){return s.texts.delete(t)}const x=class x{constructor(t=0,e=0,i=!0){a(this,"_x",0);a(this,"_y",0);a(this,"useInt");this.useInt=i,typeof t=="number"?(this.x=t,this.y=e):typeof t=="object"&&(this.x=t.x,this.y=t.y)}get x(){return this._x}set x(t){this._x=this.useInt?Math.round(t):t}get y(){return this._y}set y(t){this._y=this.useInt?Math.round(t):t}add(t){return this.x+=t.x,this.y+=t.y,this}static add(t,e,i,n=!0){return i??(i=new x(0,0,n)),i.x=t.x+e.x,i.y=t.y+e.y,i}sub(t){return this.x-=t.x,this.y-=t.y,this}static sub(t,e,i,n=!0){return i??(i=new x(0,0,n)),i.x=t.x-e.x,i.y=t.y-e.y,i}mul(t){return t instanceof x?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this}static mul(t,e,i,n=!0){return i??(i=new x(0,0,n)),e instanceof x?(i.x=t.x*e.x,i.y=t.y*e.y):(i.x=t.x*e,i.y=t.y*e),i}div(t){return t instanceof x?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t),this}static div(t,e,i,n=!0){return i??(i=new x(0,0,n)),e instanceof x?(i.x=t.x/e.x,i.y=t.y/e.y):(i.x=t.x/e,i.y=t.y/e),i}dot(t){return this.x*t.x+this.y*t.y}static dot(t,e){return t.x*e.x+t.y*e.y}cross(t){return this.x*t.y-this.y*t.x}static cross(t,e){return t.x*e.y-t.y*e.x}len(){return Math.sqrt(this.lenSquared())}static len(t){return Math.sqrt(x.lenSquared(t))}lenSquared(){return this.dot(this)}static lenSquared(t){return x.dot(t,t)}madd(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}static madd(t,e,i,n,o=!0){return n??(n=new x(0,0,o)),n.x=t.x+e.x*i,n.y=t.y+e.y*i,n}lerp(t,e){return this.madd(t.sub(this),e)}static lerp(t,e,i,n,o=!0){return x.madd(t,x.sub(e,t),i,n,o)}bilinear(t,e){return this.x=x.lerp(this,t,e.x).x,this.y=x.lerp(this,t,e.y).y,this}static bilinear(t,e,i,n,o=!0){return n??(n=new x(0,0,o)),n.x=x.lerp(t,e,i.x,void 0,o).x,n.y=x.lerp(t,e,i.y,void 0,o).y,n}equals(t,e=1e-4){return this.useInt&&t.useInt?this.x===t.x&&this.y===t.y:Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}static equals(t,e,i=1e-4){return t.useInt&&e.useInt?t.x===e.x&&t.y===e.y:Math.abs(t.x-e.x)<i&&Math.abs(t.y-e.y)<i}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}static min(t,e,i,n=!0){return i??(i=new x(0,0,n)),i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}static max(t,e,i,n=!0){return i??(i=new x(0,0,n)),i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i}rotate(t){const e=Math.sin(t),i=Math.cos(t);return this.x=this.x*i-this.y*e,this.y=this.x*e+this.y*i,this}static rotate(t,e,i,n=!0){i??(i=new x(0,0,n));const o=Math.sin(e),r=Math.cos(e);return i.x=t.x*r-t.y*o,i.y=t.x*o+t.y*r,i}angleBetween(t){return Math.atan2(t.y-this.y,t.x-this.x)}static angleBetween(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}normalize(){return this.useInt=!1,this.div(this.len())}static normalize(t,e,i=!1){return x.div(t,t.len(),e,i)}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}static abs(t,e,i=!0){return e??(e=new x(0,0,i)),e.x=Math.abs(t.x),e.y=Math.abs(t.y),e}copy(){return new x(this,void 0,this.useInt)}static copy(t,e){return e.useInt=t.useInt,e.x=t.x,e.y=t.y,e}toPlainObject(){return{x:this.x,y:this.y,useInt:this.useInt}}};a(x,"ZERO",new x);let c=x;class Rt{constructor(t,e=2,i=2,n="#FF8008DC"){a(this,"position");a(this,"points");a(this,"globalPoints");a(this,"width");a(this,"height");a(this,"drawPath");a(this,"regenPath");a(this,"borderColor");this.position=t,this.width=e,this.height=i,this.borderColor=n,this.points=this.setPoints(),this.regenPath=!1,this.globalPoints={a:this.position,b:c.add(this.position,this.points.b)}}setGlobalPoints(){c.add(this.position,this.points.b,this.globalPoints.b)}setPoints(){return{a:c.ZERO,b:new c(this.width,this.height)}}generatePath(){const t=new Path2D;return t.rect(this.position.x,this.position.y,this.width,this.height),this.regenPath=!1,t}draw(t,e){e&&((!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle=this.borderColor,t.stroke(this.drawPath),t.restore())}moveShape(t,e=!0){e?this.position.add(t):c.copy(t,this.position),this.setGlobalPoints(),this.regenPath=!0}collisionWithPoint(t){return t.x>this.globalPoints.a.x&&t.x<this.globalPoints.b.x&&t.y>this.globalPoints.a.y&&t.y<this.globalPoints.b.y}collisionWithBox(t){return!(this.globalPoints.b.x<t.globalPoints.a.x||this.globalPoints.b.y<t.globalPoints.a.y||this.globalPoints.a.x>t.globalPoints.b.x||this.globalPoints.a.y>t.globalPoints.b.y)}collisionWithCircle(t){return t.collisionWithBox(this)}}const wt=Math.PI*.25,xt=Math.PI*.75,Ft={setCollisionShapeSize(s,t,e=0,i=0,n=0,o=0,r=1e-4){return s.useInt&&t.useInt?new c(s.x===t.x?e:i,s.y===t.y?n:o):new c(Math.abs(s.x-t.x)<r?e:i,Math.abs(s.y-t.y)<r?n:o,!1)},generateAnchors(s,t){const e=[];let i=new c;const n=s.copy(),o=new c(2,1,!1);let r,l=0;for(;l<64;){const h=new c(0,0,!1),f=n.angleBetween(t);if(h.x=f<=wt&&f>=-wt?1:f>xt||f<-xt?-1:0,h.y=f>wt&&f<=xt?1:f<-wt&&f>=-xt?-1:0,e.length===0?r=h.abs().div(o):r=h.abs().div(o).add(i),c.bilinear(s,t,r,n),e.push(r),i=r.copy(),n.equals(t))break;l+=1}return e},generateCollisionShapes(s,t,e){if(e.length===0)return[];const i=[];let n=s.copy();const o=new c;for(let r=0;r<=e.length;r++){r<e.length?c.bilinear(s,t,e[r],o):c.copy(t,o);const l=this.setCollisionShapeSize(n,o,12,o.x-n.x,12,o.y-n.y);i.push(new Rt(n.sub(new c(6,6)),l.x,l.y)),n=o.copy()}return i}};class Ne{constructor(t,e,i,n={start:void 0,end:void 0},o){a(this,"id");a(this,"position");a(this,"componentType");a(this,"endPosition");a(this,"anchors");a(this,"connectedTo");a(this,"drawPath");a(this,"regenPath");a(this,"collisionShape");a(this,"selected");this.id=t,this.position=e,this.componentType=y.LINE,this.endPosition=i,this.anchors=o??[new c(.25,0),new c(.25,.5),new c(.5,.5),new c(.5,1)],this.connectedTo=n,this.regenPath=!0,this.collisionShape=this.generateCollisionShapes(),this.selected=!1}generatePath(){const t=new Path2D;t.moveTo(this.position.x,this.position.y);const e=new c;for(let i=0;i<this.anchors.length;i++)c.bilinear(this.position,this.endPosition,this.anchors[i],e),t.lineTo(e.x,e.y);return t.lineTo(this.endPosition.x,this.endPosition.y),this.regenPath=!1,t}generateCollisionShapes(){return Ft.generateCollisionShapes(this.position,this.endPosition,this.anchors)}generateAnchors(){return Ft.generateAnchors(this.position,this.endPosition)}draw(t){if(this.endPosition!==this.position){(this.regenPath||!this.drawPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle="#101010",t.lineWidth=2,t.lineJoin="round",t.stroke(this.drawPath),t.restore();for(let e=0;e<this.collisionShape.length;e++)this.collisionShape[e].draw(t,this.selected)}}addAnchor(t,e=this.anchors.length){this.anchors.splice(e,0,t),this.regenPath=!0}removePoint(t=this.anchors.length-1){if(t<0||t>=this.anchors.length){console.error("ConnectionComponent.removePoint - index is out of bounds!");return}this.anchors.splice(t,1),this.regenPath=!0}move(t,e=!0,i=2,n=!0){e?(i!==1&&this.position.add(t),i!==0&&this.endPosition.add(t)):(i!==1&&c.copy(t,this.position),i!==0&&c.copy(t,this.endPosition)),this.anchors=this.generateAnchors(),n&&(this.collisionShape=this.generateCollisionShapes()),this.regenPath=!0}changeAnchor(t,e=this.anchors.length-1){if(e<0||e>=this.anchors.length){console.error("ConnectionComponent.changePosition - index is out of bounds!");return}this.anchors[e]=c.sub(t,this.position,void 0,!1).div(c.sub(this.endPosition,this.position,void 0,!1)),this.regenPath=!0}changeConnection(t,e,i=!1){t!==void 0&&e!==void 0?i?this.connectedTo.end={slotId:t,nodeId:e}:this.connectedTo.start={slotId:t,nodeId:e}:i?this.connectedTo.end=void 0:this.connectedTo.start=void 0}toObject(){const t={id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),endPosition:this.endPosition.toPlainObject(),anchors:[],connectedTo:this.connectedTo};return this.anchors.forEach(e=>t.anchors.push(e.toPlainObject())),t}}const Xt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m64%2025h25m-64-10h-26m27%2020h-27'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cpath%20d='m26.857%207.8571h17.619c9.7607%200%2016.667%207.64%2016.667%2017.143s-7.3822%2017.143-17.143%2017.143h-17.143z'%20fill='%23fff'/%3e%3cpath%20d='m24%205v40h20.476c11.268%200%2020-9%2020-20s-8.7321-20-20-20zm2.8571%202.8571h17.619c9.7607%200%2016.667%207.64%2016.667%2017.143s-7.3822%2017.143-17.143%2017.143h-17.143z'/%3e%3c/svg%3e",Kt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m73%2025h16m-64-10h-26m27%2020h-27'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cpath%20d='m26.857%207.8571h17.619c9.7607%200%2016.667%207.64%2016.667%2017.143s-7.3822%2017.143-17.143%2017.143h-17.143z'%20fill='%23fff'/%3e%3cpath%20d='m24%205v40h20.476c11.268%200%2020-9%2020-20s-8.7321-20-20-20zm2.8571%202.8571h17.619c9.7607%200%2016.667%207.64%2016.667%2017.143s-7.3822%2017.143-17.143%2017.143h-17.143z'/%3e%3cpath%20d='m73%2025a4%204%200%201%201-8%200%204%204%200%201%201%208%200z'%20fill='%23fff'%20stroke='%23000'%20stroke-width='3'/%3e%3c/svg%3e",Jt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m73%2025h16m-64-10h-26m27%2020h-27'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cpath%20d='m23.969%208h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill='%23fff'%20fill-rule='evenodd'/%3e%3cpath%20d='m18.094%205%202%202.4375s5.6562%207%205.6562%2017.562-5.6562%2017.562-5.6562%2017.562l-2%202.4375h17.156c2.4081%201e-6%207.6897%200.02451%2013.625-2.4062%205.9353-2.4308%2012.537-7.3433%2017.688-16.875l-1.3125-0.71875%201.3125-0.71875c-10.303-19.066-26.556-19.281-31.312-19.281zm5.875%203h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill-rule='evenodd'/%3e%3cpath%20d='m73%2025a4%204%200%201%201-8%200%204%204%200%201%201%208%200z'%20fill='%23fff'%20stroke='%23000'%20stroke-width='3'/%3e%3c/svg%3e",qt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m73.135%2025h15.843m-65.957%200h-24'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cpath%20d='m25.947%207.4063%2036.125%2017.594-36.125%2017.594z'%20fill='%23fff'/%3e%3cpath%20d='m72.978%2025a4%204%200%201%201-8%200%204%204%200%201%201%208%200z'%20fill='%23fff'%20stroke='%23000'%20stroke-width='3'/%3e%3cpath%20d='m22.947%202.5938v44.812l2.1562-1.0625%2041.031-20v-2.6875l-41.031-20zm3%204.8125%2036.125%2017.594-36.125%2017.594z'/%3e%3c/svg%3e",Yt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m64%2025h25m-64-10h-26m27%2020h-27'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cpath%20d='m23.969%208h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill='%23fff'%20fill-rule='evenodd'/%3e%3cpath%20d='m18.094%205%202%202.4375s5.6562%207%205.6562%2017.562-5.6562%2017.562-5.6562%2017.562l-2%202.4375h17.156c2.4081%201e-6%207.6897%200.02451%2013.625-2.4062%205.9353-2.4308%2012.537-7.3433%2017.688-16.875l-1.3125-0.71875%201.3125-0.71875c-10.303-19.066-26.556-19.281-31.312-19.281zm5.875%203h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill-rule='evenodd'/%3e%3c/svg%3e",Qt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m72.333%2025h16.667m-64.614-10h-25.386m26.362%2020h-26.362'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cg%20transform='translate(-6)'%20fill-rule='evenodd'%3e%3cpath%20d='m24.25%2042c-1.5974%202.6444-2.25%203-2.25%203h-3.6562l2-2.4375s5.6562-7.0001%205.6562-17.563-5.6562-17.562-5.6562-17.562l-2-2.4375h3.6562c0.78125%200.9375%201.4219%201.6562%202.2188%203%201.8727%203.0998%204.7812%209.0266%204.7812%2017%200%207.9506-2.8967%2013.879-4.75%2017z'/%3e%3cpath%20d='m29.969%208h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill='%23fff'/%3e%3cpath%20d='m24.094%205%202%202.4375s5.6562%207%205.6562%2017.562-5.6562%2017.562-5.6562%2017.562l-2%202.4375h17.156c2.4081%201e-6%207.6897%200.02451%2013.625-2.4062%205.9353-2.4308%2012.537-7.3433%2017.688-16.875l-1.3125-0.71875%201.3125-0.71875c-10.303-19.066-26.556-19.281-31.312-19.281zm5.875%203h11.281c4.6842%200%2018.287-0.13021%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'/%3e%3c/g%3e%3cpath%20d='m73%2025a4%204%200%201%201-8%200%204%204%200%201%201%208%200z'%20fill='%23fff'%20stroke='%23000'%20stroke-width='3'/%3e%3c/svg%3e",Vt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='88'%20height='50'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='m64%2025h25m-64.614-10h-25.386m26.362%2020h-26.362'%20fill='none'%20stroke='%23000'%20stroke-width='2'/%3e%3cg%20transform='translate(-6)'%20fill-rule='evenodd'%3e%3cpath%20d='m24.25%2042c-1.5974%202.6444-2.25%203-2.25%203h-3.6562l2-2.4375s5.6562-7%205.6562-17.562-5.6562-17.562-5.6562-17.562l-2-2.4375h3.6562c0.78125%200.9375%201.4219%201.6562%202.2188%203%201.8727%203.0998%204.7812%209.0266%204.7812%2017%200%207.9506-2.8967%2013.879-4.75%2017z'/%3e%3cpath%20d='m29.969%208h11.281c4.6842%200%2018.287-0.1302%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'%20fill='%23fff'/%3e%3cpath%20d='m24.094%205%202%202.4375s5.6562%207%205.6562%2017.562-5.6562%2017.562-5.6562%2017.562l-2%202.4375h17.156c2.4081%200%207.6897%200.02451%2013.625-2.4062s12.537-7.3433%2017.688-16.875l-1.3125-0.71875%201.3125-0.71875c-10.303-19.066-26.556-19.281-31.312-19.281zm5.875%203h11.281c4.6842%200%2018.287-0.1302%2027.969%2017-4.7668%208.4291-10.521%2012.684-15.719%2014.812-5.3607%202.1954-9.8419%202.1875-12.25%202.1875h-11.25c1.8736-3.1084%204.75-9.0494%204.75-17%200-7.9734-2.9085-13.9-4.7812-17z'/%3e%3c/g%3e%3c/svg%3e",Me={id:v.G_AND,imgPath:[Xt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},Le={id:v.G_NAND,imgPath:[Kt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},_e={id:v.G_NOR,imgPath:[Jt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},De={id:v.G_NOT,imgPath:[qt],connectionSlot:[{id:0,name:"In",in:!0,localPos:new c(0,25)},{id:1,name:"Out",in:!1,localPos:new c(88,25)}]},Ae={id:v.G_OR,imgPath:[Yt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},ze={id:v.G_XNOR,imgPath:[Qt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},Re={id:v.G_XOR,imgPath:[Vt],connectionSlot:[{id:0,name:"A",in:!0,localPos:new c(0,15)},{id:1,name:"B",in:!0,localPos:new c(0,35)},{id:2,name:"C",in:!1,localPos:new c(88,25)}]},st={ADDNode:Me,NANDNode:Le,NORNode:_e,NOTNode:De,ORNode:Ae,XNORNode:ze,XORNode:Re},$t="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzAiIGhlaWdodD0iNTAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcwIDUwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KIDxnPgogIDxyZWN0IHg9IjEiIHk9IjEiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8cGF0aCBkPSJtNDkuNSAyNS4wNDRoMjEuNSIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIuMTEzNiIvPgogIDx0ZXh0IHg9IjE1Ljg0OCIgeT0iMzYuNDM5OTk5IiBmaWxsPSIjMDAwMDAwIiBmb250LXNpemU9IjMycHgiIHN0cm9rZT0iIzAwMDAwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHRzcGFuIHg9IjE1Ljg0OCIgeT0iMzYuNDM5OTk5IiBmaWxsPSIjMDAwMDAwIiBmb250LXNpemU9IjMycHgiIHN0cm9rZT0iIzAwMDAwMCI+MDwvdHNwYW4+PC90ZXh0PgogPC9nPgo8L3N2Zz4K",te="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzAiIGhlaWdodD0iNTAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDcwIDUwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHJlY3QgeD0iMSIgeT0iMSIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIvPgogIDxwYXRoIGQ9Im00OS41IDI1LjA0NGgyMS41IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMi4xMTM2Ii8+CiAgPHRleHQgeD0iMTUuODQ4IiB5PSIzNi40Mzk5OTkiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjMycHgiIHN0cm9rZT0iIzAwMDAwMCIgc3R5bGU9ImZvbnQtdmFyaWFudC1jYXBzOm5vcm1hbDtmb250LXZhcmlhbnQtZWFzdC1hc2lhbjpub3JtYWw7Zm9udC12YXJpYW50LWxpZ2F0dXJlczpub3JtYWw7Zm9udC12YXJpYW50LW51bWVyaWM6bm9ybWFsIiB4bWw6c3BhY2U9InByZXNlcnZlIj48dHNwYW4+MTwvdHNwYW4+PC90ZXh0PgogPC9nPgo8L3N2Zz4K",je={id:v.I_SWITCH,imgPath:[$t,te],connectionSlot:[{id:0,in:!1,name:"A",localPos:new c(70,25)}]},ee="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='46.08'%20height='64'%20version='1.1'%20viewBox='0%200%2046.08%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20stroke='%23000'%20stroke-linejoin='round'%3e%3cpath%20d='m23.041%202.5131c-6.8934%200-12.445%204.8028-12.445%2010.768v18.825%202.7066h-7.2638v9.2635h39.415v-9.2635h-7.2638v-2.7066-18.825c0-5.9654-5.5488-10.768-12.442-10.768z'%20fill='%23d9d9d9'%20stroke-width='2.5854'/%3e%3cpath%20d='m9.619%2035.474h26.424'%20fill='%23fdfdfd'%20stroke-width='1.2927'/%3e%3cpath%20d='m23.04%2044.39v21.976'%20fill='%23fdfdfd'%20stroke-width='2.8546'/%3e%3c/g%3e%3c/svg%3e",se="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='46.08'%20height='64'%20version='1.1'%20viewBox='0%200%2046.08%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20stroke='%23000'%20stroke-linejoin='round'%3e%3cpath%20d='m23.041%202.5131c-6.8934%200-12.445%204.8028-12.445%2010.768v18.825%202.7066h-7.2638v9.2635h39.415v-9.2635h-7.2638v-2.7066-18.825c0-5.9654-5.5488-10.768-12.442-10.768z'%20fill='%23ff4949'%20stroke-width='2.5854'/%3e%3cpath%20d='m9.619%2035.474h26.424'%20fill='%23fdfdfd'%20stroke-width='1.2927'/%3e%3cpath%20d='m23.04%2044.39v21.976'%20fill='%23fdfdfd'%20stroke-width='2.8546'/%3e%3c/g%3e%3c/svg%3e",Ee={id:v.O_LED_RED,imgPath:[ee,se],connectionSlot:[{id:0,in:!0,name:"A",localPos:new c(23,64)}]};async function Be(s){const t=new Image;return t.src=s,await t.decode(),window.createImageBitmap(t)}function Fe(s,t){const e={};let i=0;for(const n of t)Object.keys(s).includes(n)&&(e[i]=s[n],i++);return e}class bt{constructor(t,e,i,n,o,r,l,h,f,d=!0){a(this,"id");a(this,"position");a(this,"componentType");a(this,"nodeType");a(this,"slots");a(this,"collisionShape");a(this,"_images");a(this,"imageWidth");a(this,"imageHeight");a(this,"_signalData");a(this,"selected");var u,g;if(this.id=t,this.position=e,this.componentType=i,this.nodeType=bt.getNodeModel(n),this._signalData=f[this.id],this.slots=l,this._images=Fe(h,this.nodeType.imgPath),this.imageWidth=((u=this.image)==null?void 0:u.width)??100,this.imageHeight=((g=this.image)==null?void 0:g.height)??100,d){this.position.sub(new c(this.imageWidth/2,this.imageHeight/2));const w=new c(o,r).sub(new c(this.imageWidth,this.imageHeight));this.position.min(w).max(c.ZERO)}this.collisionShape=new Rt(this.position,this.imageWidth,this.imageHeight),this.selected=!1}get image(){return Object.keys(this._images).length===0?null:this.componentType===y.NODE?this._images[0]:this._images[this.state?1:0]}get state(){return this._signalData.state??!1}set state(t){this._signalData.state=t}static getNodeModel(t){switch(t){case v.G_AND:return st.ADDNode;case v.G_NAND:return st.NANDNode;case v.G_NOR:return st.NORNode;case v.G_NOT:return st.NOTNode;case v.G_OR:return st.ORNode;case v.G_XNOR:return st.XNORNode;case v.G_XOR:return st.XORNode;case v.I_SWITCH:return je;case v.O_LED_RED:return Ee;default:return st.NOTNode}}move(t,e=!0){e?(this.position.add(t),this.collisionShape.moveShape(this.position,!1)):(c.sub(t,new c(this.imageWidth/2,this.imageHeight/2),this.position),this.collisionShape.moveShape(this.position,!1))}draw(t){this.image&&(t.drawImage(this.image,this.position.x,this.position.y),this.collisionShape!==void 0&&this.collisionShape.draw(t,this.selected))}toObject(){return{id:this.id,componentType:this.componentType,nodeType:this.nodeType.id,position:this.position.toPlainObject(),slotIds:this.slots.map(e=>e.id),state:this.state}}}class Ge{constructor(t,e,i="#FF8008DC"){a(this,"position");a(this,"radius");a(this,"radiusSquared");a(this,"drawPath");a(this,"regenPath");a(this,"borderColor");this.position=t,this.radius=e,this.radiusSquared=e*e,this.borderColor=i,this.regenPath=!1}generatePath(){const t=new Path2D;return t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),this.regenPath=!1,t}draw(t,e){e&&((!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.strokeStyle=this.borderColor,t.stroke(this.drawPath),t.restore())}moveShape(t,e=!0){e?this.position.add(t):c.copy(t,this.position),this.drawPath=this.generatePath()}collisionWithPoint(t){return c.sub(this.position,t).lenSquared()<this.radiusSquared}collisionWithBox(t){let e=0;return this.position.x<t.globalPoints.b.x?e+=Math.pow(t.globalPoints.b.x-this.position.x,2):this.position.x>t.globalPoints.a.x&&(e+=Math.pow(this.position.x-t.globalPoints.a.x,2)),this.position.y<t.globalPoints.b.y?e+=Math.pow(t.globalPoints.b.y-this.position.y,2):this.position.y>t.globalPoints.a.y&&(e+=Math.pow(this.position.y-t.globalPoints.a.y,2)),e<this.radiusSquared}collisionWithCircle(t){return c.sub(this.position,t.position).len()<this.radius+t.radius}}class We{constructor(t,e,i,n=[],o=!0,r=4,l=12,h="#0880FF",f="#FF0000"){a(this,"id");a(this,"position");a(this,"globalPosition");a(this,"componentType");a(this,"parent");a(this,"_slotConnections");a(this,"drawPath");a(this,"regenPath");a(this,"selected");a(this,"inSlot");a(this,"color");a(this,"colorActive");a(this,"radius");a(this,"attractionRadius");a(this,"collisionShape");this.id=t,this.position=e,this.globalPosition=c.add(e,i.position),this.componentType=y.SLOT,this.parent=i,this._slotConnections=n,this.color=h,this.colorActive=f,this.selected=!1,this.inSlot=o,this.radius=r,this.attractionRadius=l,this.collisionShape=new Ge(this.globalPosition,this.attractionRadius),this.regenPath=!1}get slotConnections(){return this._slotConnections}set slotConnections(t){this.inSlot?(this._slotConnections.splice(0,this._slotConnections.length),this._slotConnections.push(t[0])):this._slotConnections=t}move(t,e=!0){c.add(this.position,this.parent.position,this.globalPosition),this.collisionShape.moveShape(this.globalPosition,!1),this.regenPath=!0}generatePath(){const t=new Path2D;return t.arc(this.globalPosition.x,this.globalPosition.y,this.radius,0,Math.PI*2),t}draw(t){(!this.drawPath||this.regenPath)&&(this.drawPath=this.generatePath()),t.save(),t.fillStyle=this.selected?this.colorActive:this.color,t.fill(this.drawPath),t.restore(),this.collisionShape.draw(t,this.selected)}toObject(){return{id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),parentId:this.parent.id,connectionIds:this.slotConnections.map(e=>e.id),inSlot:this.inSlot,color:this.color,colorActive:this.colorActive,radius:this.radius,attractionRadius:this.attractionRadius}}}class Ue{constructor(t,e,i="",n="12px sans-serif",o,r){a(this,"id");a(this,"position");a(this,"componentType");a(this,"text");a(this,"parent");a(this,"style");a(this,"textSize");a(this,"collisionShape");a(this,"canvasContext");a(this,"selected");this.id=t,this.position=e,this.componentType=y.TEXT,this.text=i,this.style=n,this.parent=o,this.canvasContext=r,this.textSize=this.measureText(i,n),this.position.sub(c.div(this.textSize,2)),this.collisionShape=new Rt(this.position,this.textSize.x,this.textSize.y),this.selected=!1}measureText(t,e){this.canvasContext.font=e,this.canvasContext.textBaseline="top",this.canvasContext.textAlign="left";const i=this.canvasContext.measureText(t);return new c(i.width,i.actualBoundingBoxDescent-i.actualBoundingBoxAscent).max(new c(16,16))}draw(t){t.save(),t.font=this.style,t.textBaseline="top",t.textAlign="left",t.fillText(this.text,this.position.x,this.position.y),t.restore(),this.collisionShape.draw(t,this.selected)}move(t,e=!0){e?this.position.add(t):c.sub(t,c.div(this.textSize,2),this.position),this.collisionShape.moveShape(this.position,!1)}toObject(){return{id:this.id,componentType:this.componentType,position:this.position.toPlainObject(),text:this.text,parent:this.parent,style:this.style}}}const q={node(s=-1,t,e,i,n,o,r,l=y.NODE,h=[],f=!0,d=!1){const u=s>=0?s:t.nextComponentId;Pt.addVertex(t.signalGraph,u,n,d),(l===y.LINE||l===y.SLOT||l===y.TEXT)&&(l=y.NODE);let g=new bt(u,new c(o,r),l,n,e,i,[],t.nodeImageList,t.signalGraph,f);if(t.nodes.set(u,g),g=t.nodes.get(u),t.updateComponentId(s>=0?s:void 0),h.length===0){const w=bt.getNodeModel(n).connectionSlot;for(const C of Object.values(w)){const b=this.slot(void 0,t,C.localPos.x,C.localPos.y,g,C.in);if(!g.slots.find(S=>S.id===b)){const S=t.slots.get(b);S&&g.slots.push(S)}}}else for(const w of h){const C=t.slots.get(w);C&&g.slots.push(C)}return u},input(s=-1,t,e,i,n,o,r,l,h=!0,f=!1){return this.node(s,t,e,i,n,o,r,y.INPUT,l,h,f)},output(s=-1,t,e,i,n,o,r,l,h=!0,f=!1){return this.node(s,t,e,i,n,o,r,y.OUTPUT,l,h,f)},slot(s=-1,t,e,i,n,o,r,l,h,f){const d=s>=0?s:t.nextComponentId,u=new We(d,new c(e,i),n,void 0,o,r,l,h,f);return t.slots.set(d,u),(n.componentType===y.INPUT||n.componentType===y.OUTPUT||n.componentType===y.NODE)&&n.slots.push(t.slots.get(d)),t.updateComponentId(s>=0?s:void 0)},connection(s=-1,t,e,i,n,o,r,l,h){const f=s>=0?s:t.nextComponentId,d=new Ne(f,new c(e,i),new c(n,o),{start:r,end:l},h);return t.connections.set(f,d),t.updateComponentId(s>=0?s:void 0)},text(s=-1,t,e,i,n,o,r,l){const h=s>=0?s:t.nextComponentId,f=new Ue(h,new c(n,o),i,r,l?{id:l.id,type:l.componentType}:null,e);return t.texts.set(h,f),t.updateComponentId(s>=0?s:void 0)}};class mt{constructor(t,e=0,i,n={},o=new Map,r=new Map,l=new Map,h=new Map){a(this,"documentId");a(this,"_nextComponentId");a(this,"nodes");a(this,"slots");a(this,"connections");a(this,"texts");a(this,"nodeImageList");a(this,"signalGraph");this.documentId=t,this._nextComponentId=e,this.nodes=o,this.slots=r,this.connections=l,this.texts=h,this.signalGraph=n,this.nodeImageList=i}getDocumentId(){return this.documentId}get components(){return{nodes:this.nodes,slots:this.slots,connections:this.connections,texts:this.texts}}get nextComponentId(){return this._nextComponentId}updateComponentId(t){const e=this._nextComponentId;return this._nextComponentId=t?Math.max(this._nextComponentId,t+1):this._nextComponentId+1,e}removeComponent(t=this._nextComponentId-1,e){if(e)switch(e){case y.NODE:case y.INPUT:case y.OUTPUT:return ke(this,t);case y.SLOT:return Se(this,t);case y.LINE:return Te(this,t);case y.TEXT:return Oe(this,t)}else{const i=this.connections.get(t)??this.nodes.get(t)??this.slots.get(t)??this.texts.get(t);if(i!==void 0)return this.removeComponent(i.id,i.componentType)}return!1}saveAsJson(){const t={id:this.documentId,data:{nodes:[],connections:[],slots:[],texts:[]},signal:{}};for(const[e,i]of Object.entries(this.components))for(const n of i.values())switch(e){case"nodes":t.data.nodes.push(n.toObject());break;case"slots":t.data.slots.push(n.toObject());break;case"connections":t.data.connections.push(n.toObject());break;case"texts":t.data.texts.push(n.toObject());break}return t.signal=this.signalGraph,JSON.stringify(t)}static createFromJson(t,e,i){const n=new mt(t.id,0,structuredClone(i),t.signal);for(const o of t.data.nodes)q.node(o.id,n,e.canvas.width,e.canvas.height,o.nodeType,o.position.x,o.position.y,o.componentType,o.slotIds,!1);for(const o of t.data.slots)q.slot(o.id,n,o.position.x,o.position.y,n.nodes.get(o.parentId),o.inSlot,o.radius,o.attractionRadius,o.color,o.colorActive);for(const o of t.data.connections)q.connection(o.id,n,o.position.x,o.position.y,o.endPosition.x,o.endPosition.y,o.connectedTo.start,o.connectedTo.end,o.anchors.map(r=>new c(r.x,r.y,r.useInt))),o.connectedTo.start&&n.slots.get(o.connectedTo.start.slotId).slotConnections.push(n.connections.get(o.id)),o.connectedTo.end&&n.slots.get(o.connectedTo.end.slotId).slotConnections.push(n.connections.get(o.id));for(const o of t.data.texts){q.text(o.id,n,e,o.text,o.position.x,o.position.y,o.style);break}return n}}const jt={checkComponentClick(s,t){const e=[];for(const[i,n]of t.entries())n.collisionShape.collisionWithPoint(s)&&e.push(i);return e}},Mt={checkSlotClick(s,t){return jt.checkComponentClick(t,s)}},yt={editingLineId:-1,editingLine:!1,lineStartSlot:-1,oldSlotCollision:-1,slotCollision:-1,checkConnectionClick(s,t){const e=[];for(const[i,n]of s.entries())n.collisionShape.find(r=>r.collisionWithPoint(t))!==void 0&&e.push(i);return e},addLine(s,t){if(this.editingLine&&this.editingLineId!==-1)return!0;const e=t.getCollisionList().slots;if(e.length>0){const i=s.slots.get(e[0]);return i?(this.editingLineId=q.connection(void 0,s,i.globalPosition.x,i.globalPosition.y,i.globalPosition.x,i.globalPosition.y,{slotId:i.id,nodeId:i.parent.id}),this.editingLine=!0,this.oldSlotCollision=this.slotCollision,this.slotCollision=i.id,this.lineStartSlot=i.id,!0):!1}else this.oldSlotCollision=this.slotCollision,this.slotCollision=-1;return!1},move(s,t,e){if(!this.editingLine||this.editingLineId===-1||!(t.movingObject==="none"||t.movingObject==="connection")||!s.connections.has(this.editingLineId))return!1;t.movingObject="connection";const i=s.connections.get(this.editingLineId);return i?(i.move(e,!1,1,!1),this.bindConnection(s,e),!0):!1},fixLine(s,t){if(this.editingLine&&this.editingLineId!==-1){const e=Mt.checkSlotClick(s.slots,t);if(this.slotCollision!==-1&&e.length>0&&e[0]!==this.lineStartSlot){let i=s.slots.get(this.lineStartSlot),n=s.slots.get(e[0]);const o=s.connections.get(this.editingLineId);if(i.inSlot===n.inSlot)return s.removeComponent(this.editingLineId,y.LINE),this.resetConnEventParams(),!1;if(!n.inSlot){const r=this.lineStartSlot,l=i;this.lineStartSlot=e[0],i=n,e[0]=r,n=l}return this.removeOldInSlotConnection(s,i),this.removeOldInSlotConnection(s,n),i.slotConnections=[...i.slotConnections,o],n.slotConnections=[...n.slotConnections,o],this.changeConnectionParams(s.connections.get(this.editingLineId),i.globalPosition,n.globalPosition,this.lineStartSlot,i.parent.id,e[0],n.parent.id),Pt.addEdge(s.signalGraph,o),o.collisionShape=o.generateCollisionShapes(),this.resetConnEventParams(),!0}else return s.removeComponent(this.editingLineId,y.LINE),this.resetConnEventParams(),!1}return this.resetConnEventParams(),!1},bindConnection(s,t){var e;if(this.editingLine&&this.editingLineId!==-1){const i=Mt.checkSlotClick(s.slots,t),n=s.connections.get(this.editingLineId);if(i.length>0){if(((e=n.connectedTo.start)==null?void 0:e.slotId)!==i[0]){const o=s.slots.get(i[0]);this.oldSlotCollision=this.slotCollision,this.slotCollision=i[0],n.endPosition=new c(o.globalPosition)}}else this.slotCollision!==-1&&(this.oldSlotCollision=this.slotCollision,this.slotCollision=-1),n.endPosition=t}},changeConnectionParams(s,t,e,i,n,o,r){t!==void 0&&s.move(t,!1,0,!1),e!==void 0&&s.move(e,!1,1,!1),i!==void 0&&n!==void 0&&s.changeConnection(i,n,!1),o!==void 0&&r!==void 0&&s.changeConnection(o,r,!0)},removeOldInSlotConnection(s,t){if(!t.inSlot)return;const e=t.slotConnections[0];e!==void 0&&(t.slotConnections.splice(0,t.slotConnections.length),e.connectedTo.start&&s.slots.get(e.connectedTo.start.slotId).slotConnections.find((i,n,o)=>{var r;return i.id===((r=e.connectedTo.start)==null?void 0:r.slotId)?(o.splice(n,1),!0):!1}),e.connectedTo.end&&s.slots.get(e.connectedTo.end.slotId).slotConnections.find((i,n,o)=>{var r;return i.id===((r=e.connectedTo.end)==null?void 0:r.slotId)?(o.splice(n,1),!0):!1}),s.removeComponent(e.id,y.LINE))},resetConnEventParams(){this.editingLine=!1,this.editingLineId=-1,this.slotCollision=-1,this.oldSlotCollision=-1,this.lineStartSlot=-1}},St={checkNodeClick(s,t){return jt.checkComponentClick(t,s)},move(s,t,e,i=!0){const n=t.getCollisionList().nodes;if(n.length===0||!(t.movingObject==="none"||t.movingObject==="node"))return!1;t.movingObject="node";const o=s.nodes.get(n[0]);return o===void 0?!1:(o.move(e,i),this.moveLinkedElements(o,i),!0)},moveLinkedElements(s,t=!0){var e,i;for(const n of s.slots)if(n){n.move();for(let o=0;o<n.slotConnections.length;o++){const r=n.slotConnections[o];((e=r.connectedTo.start)==null?void 0:e.slotId)===n.id?r.move(n.globalPosition,t,0):((i=r.connectedTo.end)==null?void 0:i.slotId)===n.id&&r.move(n.globalPosition,t,1)}}},switchInputState(s,t){const e=s.get(t);return e&&e.componentType===y.INPUT?(e.state=!e.state,!0):!1}},Gt={checkTextClick(s,t){return jt.checkComponentClick(t,s)},move(s,t,e,i=!0){const n=t.getCollisionList().texts;if(n.length===0||!(t.movingObject==="none"||t.movingObject==="text"))return!1;t.movingObject="text";const o=s.get(n[0]);return o===void 0?!1:(o.move(e,i),!0)}};class He{constructor(t){a(this,"collisionList");a(this,"_mouse");a(this,"movingObject");this._mouse=t,this.collisionList={nodes:[],slots:[],connections:[],texts:[]},this.movingObject="none"}onMouseClick(t){if(this._mouse.stateChanged&&this._mouse.clicked){this.clearAllCollisions(t);const e=St.checkNodeClick(t.nodes,this._mouse.position),i=Mt.checkSlotClick(t.slots,this._mouse.position),n=yt.checkConnectionClick(t.connections,this._mouse.position),o=Gt.checkTextClick(t.texts,this._mouse.position);this.clearUnselectedComponents(t,e,i,n,o),this.collisionList={nodes:e,slots:i,connections:n,texts:o},yt.addLine(t,this),this.showSelectedComponents(t),this._mouse.stateChanged=!1}}onMouseRelease(t){!this._mouse.clicked&&this._mouse.stateChanged&&(this._mouse.dragged||this.collisionList.nodes.length!==0&&St.switchInputState(t.nodes,this.collisionList.nodes[0])&&ft.updateGraphPartial(t.signalGraph,this.collisionList.nodes[0]),yt.fixLine(t,this._mouse.position),this._mouse.stateChanged=!1),this.movingObject="none"}onMouseMove(t){return this._mouse.clicked&&this._mouse.dragged?yt.move(t,this,this._mouse.position)||St.move(t,this,this._mouse.position,!1)||Gt.move(t.texts,this,this._mouse.position,!1):!1}showSelectedComponents(t){for(const[e,i]of Object.entries(this.collisionList))switch(e){case"slots":const n=t.slots.get(i[0]);n&&(n.selected=!0);break;case"nodes":const o=t.nodes.get(i[0]);o&&(o.selected=!0);break;case"texts":const r=t.texts.get(i[0]);r&&(r.selected=!0);break;case"connections":const l=t.connections.get(i[0]);l&&(l.selected=!0);break}}clearUnselectedComponents(t,e=[],i=[],n=[],o=[]){if(this.collisionList.nodes.length!==0){for(let r=0;r<this.collisionList.nodes.length;r++)if(!e.includes(this.collisionList.nodes[r])){const l=t.nodes.get(this.collisionList.nodes[r]);l&&(l.selected=!1)}}if(this.collisionList.slots.length!==0){for(let r=0;r<this.collisionList.slots.length;r++)if(!i.includes(this.collisionList.slots[r])){const l=t.slots.get(this.collisionList.slots[r]);l&&(l.selected=!1)}}if(this.collisionList.connections.length!==0){for(let r=0;r<this.collisionList.connections.length;r++)if(!n.includes(this.collisionList.connections[r])){const l=t.connections.get(this.collisionList.connections[r]);l&&(l.selected=!1)}}if(this.collisionList.texts.length!==0){for(let r=0;r<this.collisionList.texts.length;r++)if(!o.includes(this.collisionList.texts[r])){const l=t.texts.get(this.collisionList.texts[r]);l&&(l.selected=!1)}}}getCollisionList(){return this.collisionList}clearAllCollisions(t){this.clearUnselectedComponents(t),this.collisionList.nodes=[],this.collisionList.slots=[],this.collisionList.connections=[],this.collisionList.texts=[]}}class Ze{constructor(){a(this,"position",new c);a(this,"_mouseClicked",!1);a(this,"doubleClicked",!1);a(this,"clickStartPosition",new c);a(this,"_mouseStateChanged",!1);a(this,"clickToDragThreshold",6);a(this,"doubleClickTimer",300);a(this,"alreadyClicked",!1)}get clicked(){return this._mouseClicked}set clicked(t){this._mouseClicked=t,this._mouseStateChanged=!0,t&&(this.clickStartPosition=this.position.copy())}get dragged(){const t=c.sub(this.position,this.clickStartPosition);return t.x>this.clickToDragThreshold||t.x<-this.clickToDragThreshold||t.y>this.clickToDragThreshold||t.y<-this.clickToDragThreshold}get stateChanged(){return this._mouseStateChanged}set stateChanged(t){this._mouseStateChanged=t,this.alreadyClicked?this.doubleClicked=this._mouseClicked:(this.alreadyClicked=!0,setTimeout(()=>this.alreadyClicked=!1,this.doubleClickTimer))}}var D=Uint8Array,H=Uint16Array,Et=Int32Array,Ct=new D([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),It=new D([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lt=new D([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ie=function(s,t){for(var e=new H(31),i=0;i<31;++i)e[i]=t+=1<<s[i-1];for(var n=new Et(e[30]),i=1;i<30;++i)for(var o=e[i];o<e[i+1];++o)n[o]=o-e[i]<<5|i;return{b:e,r:n}},ne=ie(Ct,2),oe=ne.b,_t=ne.r;oe[28]=258,_t[258]=28;var re=ie(It,0),Xe=re.b,Wt=re.r,Dt=new H(32768);for(var P=0;P<32768;++P){var it=(P&43690)>>1|(P&21845)<<1;it=(it&52428)>>2|(it&13107)<<2,it=(it&61680)>>4|(it&3855)<<4,Dt[P]=((it&65280)>>8|(it&255)<<8)>>1}var Q=function(s,t,e){for(var i=s.length,n=0,o=new H(t);n<i;++n)s[n]&&++o[s[n]-1];var r=new H(t);for(n=1;n<t;++n)r[n]=r[n-1]+o[n-1]<<1;var l;if(e){l=new H(1<<t);var h=15-t;for(n=0;n<i;++n)if(s[n])for(var f=n<<4|s[n],d=t-s[n],u=r[s[n]-1]++<<d,g=u|(1<<d)-1;u<=g;++u)l[Dt[u]>>h]=f}else for(l=new H(i),n=0;n<i;++n)s[n]&&(l[n]=Dt[r[s[n]-1]++]>>15-s[n]);return l},nt=new D(288);for(var P=0;P<144;++P)nt[P]=8;for(var P=144;P<256;++P)nt[P]=9;for(var P=256;P<280;++P)nt[P]=7;for(var P=280;P<288;++P)nt[P]=8;var gt=new D(32);for(var P=0;P<32;++P)gt[P]=5;var Ke=Q(nt,9,0),Je=Q(nt,9,1),qe=Q(gt,5,0),Ye=Q(gt,5,1),Tt=function(s){for(var t=s[0],e=1;e<s.length;++e)s[e]>t&&(t=s[e]);return t},K=function(s,t,e){var i=t/8|0;return(s[i]|s[i+1]<<8)>>(t&7)&e},Ot=function(s,t){var e=t/8|0;return(s[e]|s[e+1]<<8|s[e+2]<<16)>>(t&7)},Bt=function(s){return(s+7)/8|0},ae=function(s,t,e){return(e==null||e>s.length)&&(e=s.length),new D(s.subarray(t,e))},Qe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],J=function(s,t,e){var i=new Error(t||Qe[s]);if(i.code=s,Error.captureStackTrace&&Error.captureStackTrace(i,J),!e)throw i;return i},Ve=function(s,t,e,i){var n=s.length,o=0;if(!n||t.f&&!t.l)return e||new D(0);var r=!e,l=r||t.i!=2,h=t.i;r&&(e=new D(n*3));var f=function(ct){var ht=e.length;if(ct>ht){var at=new D(Math.max(ht*2,ct));at.set(e),e=at}},d=t.f||0,u=t.p||0,g=t.b||0,w=t.l,C=t.d,b=t.m,S=t.n,X=n*8;do{if(!w){d=K(s,u,1);var F=K(s,u+1,3);if(u+=3,F)if(F==1)w=Je,C=Ye,b=9,S=5;else if(F==2){var j=K(s,u,31)+257,N=K(s,u+10,15)+4,p=j+K(s,u+5,31)+1;u+=14;for(var m=new D(p),M=new D(19),T=0;T<N;++T)M[Lt[T]]=K(s,u+T*3,7);u+=N*3;for(var z=Tt(M),tt=(1<<z)-1,G=Q(M,z,1),T=0;T<p;){var E=G[K(s,u,tt)];u+=E&15;var O=E>>4;if(O<16)m[T++]=O;else{var L=0,I=0;for(O==16?(I=3+K(s,u,3),u+=2,L=m[T-1]):O==17?(I=3+K(s,u,7),u+=3):O==18&&(I=11+K(s,u,127),u+=7);I--;)m[T++]=L}}var B=m.subarray(0,j),_=m.subarray(j);b=Tt(B),S=Tt(_),w=Q(B,b,1),C=Q(_,S,1)}else J(1);else{var O=Bt(u)+4,R=s[O-4]|s[O-3]<<8,A=O+R;if(A>n){h&&J(0);break}l&&f(g+R),e.set(s.subarray(O,A),g),t.b=g+=R,t.p=u=A*8,t.f=d;continue}if(u>X){h&&J(0);break}}l&&f(g+131072);for(var lt=(1<<b)-1,Z=(1<<S)-1,V=u;;V=u){var L=w[Ot(s,u)&lt],W=L>>4;if(u+=L&15,u>X){h&&J(0);break}if(L||J(2),W<256)e[g++]=W;else if(W==256){V=u,w=null;break}else{var U=W-254;if(W>264){var T=W-257,k=Ct[T];U=K(s,u,(1<<k)-1)+oe[T],u+=k}var Y=C[Ot(s,u)&Z],ot=Y>>4;Y||J(3),u+=Y&15;var _=Xe[ot];if(ot>3){var k=It[ot];_+=Ot(s,u)&(1<<k)-1,u+=k}if(u>X){h&&J(0);break}l&&f(g+131072);var rt=g+U;if(g<_){var vt=o-_,pt=Math.min(_,rt);for(vt+g<0&&J(3);g<pt;++g)e[g]=i[vt+g]}for(;g<rt;++g)e[g]=e[g-_]}}t.l=w,t.p=V,t.b=g,t.f=d,w&&(d=1,t.m=b,t.d=C,t.n=S)}while(!d);return g!=e.length&&r?ae(e,0,g):e.subarray(0,g)},$=function(s,t,e){e<<=t&7;var i=t/8|0;s[i]|=e,s[i+1]|=e>>8},dt=function(s,t,e){e<<=t&7;var i=t/8|0;s[i]|=e,s[i+1]|=e>>8,s[i+2]|=e>>16},Nt=function(s,t){for(var e=[],i=0;i<s.length;++i)s[i]&&e.push({s:i,f:s[i]});var n=e.length,o=e.slice();if(!n)return{t:ce,l:0};if(n==1){var r=new D(e[0].s+1);return r[e[0].s]=1,{t:r,l:1}}e.sort(function(A,j){return A.f-j.f}),e.push({s:-1,f:25001});var l=e[0],h=e[1],f=0,d=1,u=2;for(e[0]={s:-1,f:l.f+h.f,l,r:h};d!=n-1;)l=e[e[f].f<e[u].f?f++:u++],h=e[f!=d&&e[f].f<e[u].f?f++:u++],e[d++]={s:-1,f:l.f+h.f,l,r:h};for(var g=o[0].s,i=1;i<n;++i)o[i].s>g&&(g=o[i].s);var w=new H(g+1),C=At(e[d-1],w,0);if(C>t){var i=0,b=0,S=C-t,X=1<<S;for(o.sort(function(j,N){return w[N.s]-w[j.s]||j.f-N.f});i<n;++i){var F=o[i].s;if(w[F]>t)b+=X-(1<<C-w[F]),w[F]=t;else break}for(b>>=S;b>0;){var O=o[i].s;w[O]<t?b-=1<<t-w[O]++-1:++i}for(;i>=0&&b;--i){var R=o[i].s;w[R]==t&&(--w[R],++b)}C=t}return{t:new D(w),l:C}},At=function(s,t,e){return s.s==-1?Math.max(At(s.l,t,e+1),At(s.r,t,e+1)):t[s.s]=e},Ut=function(s){for(var t=s.length;t&&!s[--t];);for(var e=new H(++t),i=0,n=s[0],o=1,r=function(h){e[i++]=h},l=1;l<=t;++l)if(s[l]==n&&l!=t)++o;else{if(!n&&o>2){for(;o>138;o-=138)r(32754);o>2&&(r(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(r(n),--o;o>6;o-=6)r(8304);o>2&&(r(o-3<<5|8208),o=0)}for(;o--;)r(n);o=1,n=s[l]}return{c:e.subarray(0,i),n:t}},ut=function(s,t){for(var e=0,i=0;i<t.length;++i)e+=s[i]*t[i];return e},le=function(s,t,e){var i=e.length,n=Bt(t+2);s[n]=i&255,s[n+1]=i>>8,s[n+2]=s[n]^255,s[n+3]=s[n+1]^255;for(var o=0;o<i;++o)s[n+o+4]=e[o];return(n+4+i)*8},Ht=function(s,t,e,i,n,o,r,l,h,f,d){$(t,d++,e),++n[256];for(var u=Nt(n,15),g=u.t,w=u.l,C=Nt(o,15),b=C.t,S=C.l,X=Ut(g),F=X.c,O=X.n,R=Ut(b),A=R.c,j=R.n,N=new H(19),p=0;p<F.length;++p)++N[F[p]&31];for(var p=0;p<A.length;++p)++N[A[p]&31];for(var m=Nt(N,7),M=m.t,T=m.l,z=19;z>4&&!M[Lt[z-1]];--z);var tt=f+5<<3,G=ut(n,nt)+ut(o,gt)+r,E=ut(n,g)+ut(o,b)+r+14+3*z+ut(N,M)+2*N[16]+3*N[17]+7*N[18];if(h>=0&&tt<=G&&tt<=E)return le(t,d,s.subarray(h,h+f));var L,I,B,_;if($(t,d,1+(E<G)),d+=2,E<G){L=Q(g,w,0),I=g,B=Q(b,S,0),_=b;var lt=Q(M,T,0);$(t,d,O-257),$(t,d+5,j-1),$(t,d+10,z-4),d+=14;for(var p=0;p<z;++p)$(t,d+3*p,M[Lt[p]]);d+=3*z;for(var Z=[F,A],V=0;V<2;++V)for(var W=Z[V],p=0;p<W.length;++p){var U=W[p]&31;$(t,d,lt[U]),d+=M[U],U>15&&($(t,d,W[p]>>5&127),d+=W[p]>>12)}}else L=Ke,I=nt,B=qe,_=gt;for(var p=0;p<l;++p){var k=i[p];if(k>255){var U=k>>18&31;dt(t,d,L[U+257]),d+=I[U+257],U>7&&($(t,d,k>>23&31),d+=Ct[U]);var Y=k&31;dt(t,d,B[Y]),d+=_[Y],Y>3&&(dt(t,d,k>>5&8191),d+=It[Y])}else dt(t,d,L[k]),d+=I[k]}return dt(t,d,L[256]),d+I[256]},$e=new Et([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ce=new D(0),ts=function(s,t,e,i,n,o){var r=o.z||s.length,l=new D(i+r+5*(1+Math.ceil(r/7e3))+n),h=l.subarray(i,l.length-n),f=o.l,d=(o.r||0)&7;if(t){d&&(h[0]=o.r>>3);for(var u=$e[t-1],g=u>>13,w=u&8191,C=(1<<e)-1,b=o.p||new H(32768),S=o.h||new H(C+1),X=Math.ceil(e/3),F=2*X,O=function(kt){return(s[kt]^s[kt+1]<<X^s[kt+2]<<F)&C},R=new Et(25e3),A=new H(288),j=new H(32),N=0,p=0,m=o.i||0,M=0,T=o.w||0,z=0;m+2<r;++m){var tt=O(m),G=m&32767,E=S[tt];if(b[G]=E,S[tt]=G,T<=m){var L=r-m;if((N>7e3||M>24576)&&(L>423||!f)){d=Ht(s,h,0,R,A,j,p,M,z,m-z,d),M=N=p=0,z=m;for(var I=0;I<286;++I)A[I]=0;for(var I=0;I<30;++I)j[I]=0}var B=2,_=0,lt=w,Z=G-E&32767;if(L>2&&tt==O(m-Z))for(var V=Math.min(g,L)-1,W=Math.min(32767,m),U=Math.min(258,L);Z<=W&&--lt&&G!=E;){if(s[m+B]==s[m+B-Z]){for(var k=0;k<U&&s[m+k]==s[m+k-Z];++k);if(k>B){if(B=k,_=Z,k>V)break;for(var Y=Math.min(Z,k-2),ot=0,I=0;I<Y;++I){var rt=m-Z+I&32767,vt=b[rt],pt=rt-vt&32767;pt>ot&&(ot=pt,E=rt)}}}G=E,E=b[G],Z+=G-E&32767}if(_){R[M++]=268435456|_t[B]<<18|Wt[_];var ct=_t[B]&31,ht=Wt[_]&31;p+=Ct[ct]+It[ht],++A[257+ct],++j[ht],T=m+B,++N}else R[M++]=s[m],++A[s[m]]}}for(m=Math.max(m,T);m<r;++m)R[M++]=s[m],++A[s[m]];d=Ht(s,h,f,R,A,j,p,M,z,m-z,d),f||(o.r=d&7|h[d/8|0]<<3,d-=7,o.h=S,o.p=b,o.i=m,o.w=T)}else{for(var m=o.w||0;m<r+f;m+=65535){var at=m+65535;at>=r&&(h[d/8|0]=f,at=r),d=le(h,d+1,s.subarray(m,at))}o.i=r}return ae(l,0,i+Bt(d)+n)},es=function(){for(var s=new Int32Array(256),t=0;t<256;++t){for(var e=t,i=9;--i;)e=(e&1&&-306674912)^e>>>1;s[t]=e}return s}(),ss=function(){var s=-1;return{p:function(t){for(var e=s,i=0;i<t.length;++i)e=es[e&255^t[i]]^e>>>8;s=e},d:function(){return~s}}},is=function(s,t,e,i,n){if(!n&&(n={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),r=new D(o.length+s.length);r.set(o),r.set(s,o.length),s=r,n.w=o.length}return ts(s,t.level==null?6:t.level,t.mem==null?n.l?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):20:12+t.mem,e,i,n)},zt=function(s,t,e){for(;e;++t)s[t]=e,e>>>=8},ns=function(s,t){var e=t.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=t.level<2?4:t.level==9?2:0,s[9]=3,t.mtime!=0&&zt(s,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),e){s[3]=8;for(var i=0;i<=e.length;++i)s[i+10]=e.charCodeAt(i)}},os=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&J(6,"invalid gzip data");var t=s[3],e=10;t&4&&(e+=(s[10]|s[11]<<8)+2);for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!s[e++]);return e+(t&2)},rs=function(s){var t=s.length;return(s[t-4]|s[t-3]<<8|s[t-2]<<16|s[t-1]<<24)>>>0},as=function(s){return 10+(s.filename?s.filename.length+1:0)};function ls(s,t){t||(t={});var e=ss(),i=s.length;e.p(s);var n=is(s,t,as(t),8),o=n.length;return ns(n,t),zt(n,o-8,e.d()),zt(n,o-4,i),n}function cs(s,t){var e=os(s);return e+8>s.length&&J(6,"invalid gzip data"),Ve(s.subarray(e,-8),{i:2},new D(rs(s)),t)}var hs=typeof TextDecoder<"u"&&new TextDecoder,ds=0;try{hs.decode(ce,{stream:!0}),ds=1}catch{}function us(s,t,e){if(!e.target){console.error("Falha ao tentar carregar os dados da entrada de dados");return}const i=e.target;if(!i.files||!i.files[0])return;const n=new FileReader;n.readAsArrayBuffer(i.files[0]),n.onload=()=>{if(!n.result||typeof n.result=="string")return;const o=cs(new Uint8Array(n.result)),r=JSON.parse(new TextDecoder().decode(o));if(typeof r.id!="string"&&typeof r.data.nodes!="object"&&Number.isInteger(r.data.nodes.length)&&typeof r.data.connections!="object"&&Number.isInteger(r.data.connections.length)&&typeof r.data.slots!="object"&&Number.isInteger(r.data.slots.length)&&typeof r.data.texts!="object"&&Number.isInteger(r.data.texts.length)&&typeof r.signal!="object"){window.alert("Falha ao carregar projeto! Arquivo inválido ou corrompido."),console.error("Falha ao carregar projeto! Arquivo inválido ou corrompido.");return}s.editorEnv=mt.createFromJson(r,t,s.editorEnv.nodeImageList)}}function he(s){const t=window.prompt("Salvar projeto como:",`${s.documentId}-${Date.now()}`);if(t===null)return;const e=document.createElement("a"),i=new TextEncoder().encode(s.saveAsJson()),n=ls(i,{level:6});e.href=URL.createObjectURL(new Blob([n],{type:"application/gzip"})),e.download=`${t}.simulation`,e.click()}function fs(s){return confirm(`Deseja limpar o editor?
Qualquer progresso não salvo será perdido!`)===!0?new mt(s.documentId,0,s.nodeImageList):null}class gs{constructor(t){a(this,"_keyboard");this._keyboard=t}onKeyDown(t){this._keyboard.nKeysPressed!==0&&(this._keyboard.keyPressed?this._keyboard.keyHold=!0:(this._keyboard.keyPressed=!0,this._keyboard.keyHold=!1),this._keyboard.keyHold||this.handleKeyPressed(t))}handleKeyPressed(t){const e=this._keyboard.getKeysPressed();e.a||e.A?t.node(v.G_AND):e.d||e.D?t.node(v.G_NAND):e.r||e.R?t.node(v.G_NOR):e.n||e.N?t.node(v.G_NOT):e.o||e.O?t.node(v.G_OR):e.v||e.V?t.node(v.G_XNOR):e.x||e.X?t.node(v.G_XOR):e.s||e.S?t.input(v.I_SWITCH):e.l||e.L?t.output(v.O_LED_RED):e.Delete?t.remove():e.Insert&&he(t.editorEnv)}onKeyUp(){this._keyboard.keyPressed&&this._keyboard.nKeysPressed===0&&(this._keyboard.keyPressed=!1,this._keyboard.keyHold=!1)}}class ms{constructor(){a(this,"keys",{});a(this,"keyPressed",!1);a(this,"keyHold",!1);a(this,"stateChange",!1);a(this,"_nKeysPressed",0)}get nKeysPressed(){return this._nKeysPressed}set nKeysPressed(t){t<0&&console.warn("Número de teclas pressionadas é menor que 0!"),this._nKeysPressed=Math.max(0,t)}setKeyPressed(t,e){this.keys[t]=e,this.nKeysPressed+=e?1:-1}getKeysPressed(){return this.keys}}const vs=[Xt,Kt,Jt,qt,Yt,Qt,Vt,$t,te,ee,se];function ps(){const s={};for(const t of vs)Be(t).then(i=>{s[t]=i});return s}function ws(s,t,e){var i,n,o,r;if(!window){console.error("Variável window é nula! Não será possível iniciar o editor");return}window.onload=()=>{s.resize(),setInterval(s.compute,1e3/s.tickRate),s.update(),setTimeout(()=>{document.getElementById("app").style.visibility="visible",document.getElementById("app-toolbar").style.visibility="visible",document.getElementById("app").className="animate-show",document.getElementById("app-toolbar").className="animate-show",document.getElementById("loading-div").style.visibility="hidden"},1e3)},window.onresize=()=>s.resize(),t.onmousedown=()=>s.mouse.clicked=!0,t.onmouseup=t.onmouseout=()=>s.mouse.clicked=!1,window.onmousemove=({x:l,y:h})=>s.setLocalMousePosition(l,h),window.onkeydown=l=>s.keyboard.setKeyPressed(l.key,!0),window.onkeyup=l=>s.keyboard.setKeyPressed(l.key,!1),(i=document.getElementById("save-editor"))==null||i.addEventListener("click",()=>he(s.editorEnv)),(n=document.getElementById("load-editor"))==null||n.addEventListener("click",()=>{var l;(l=document.getElementById("load-editor-file"))==null||l.click()}),(o=document.getElementById("load-editor-file"))==null||o.addEventListener("change",l=>us(s,s.canvasCtx,l)),(r=document.getElementById("clear-editor"))==null||r.addEventListener("click",()=>{s.editorEnv=fs(s.editorEnv)??s.editorEnv})}class xs{constructor(t,e,i,n=60){a(this,"editorEnv");a(this,"mouse");a(this,"keyboard");a(this,"mouseEvents");a(this,"keyboardEvents");a(this,"canvasId");a(this,"canvasCtx");a(this,"backgroundCtx");a(this,"backgroundPattern");a(this,"windowResized");a(this,"tickRate");a(this,"update",()=>{me(this.canvasCtx,this.editorEnv.components),this.windowResized&&(ve(this.backgroundCtx,this.backgroundPattern),this.windowResized=!1),requestAnimationFrame(this.update)});a(this,"compute",()=>{this.keyboardEvents.onKeyDown(this),this.keyboardEvents.onKeyUp(),this.mouseEvents.onMouseClick(this.editorEnv),this.mouseEvents.onMouseMove(this.editorEnv),this.mouseEvents.onMouseRelease(this.editorEnv)});this.editorEnv=new mt(t,0,ps()),this.mouse=new Ze,this.keyboard=new ms,this.mouseEvents=new He(this.mouse),this.keyboardEvents=new gs(this.keyboard);const o=document.getElementById(e),r=document.getElementById(i);this.canvasId=e,this.canvasCtx=this.createContext(o),this.backgroundCtx=this.createContext(r),this.backgroundPattern=null,this.loadBackgroundPattern(fe),this.windowResized=!0,this.tickRate=n,ws(this,o)}createContext(t){return t.getContext("2d",{desynchronized:!0})}loadBackgroundPattern(t){const e=new Image;e.onload=()=>{this.backgroundPattern=this.backgroundCtx.createPattern(e,"repeat")},e.src=t}getEditorArea(){var i;const t=(i=document.getElementById(this.canvasId))==null?void 0:i.parentElement,e=new c(0,0,!1);if(t){const n=window.getComputedStyle(t);e.x=parseFloat(n.width.substring(0,n.length-2)),e.y=parseFloat(n.height.substring(0,n.length-2))}else e.x=window.innerWidth,e.y=window.innerHeight;return e}setLocalMousePosition(t,e){const i=this.canvasCtx.canvas.getBoundingClientRect();this.mouse.position=new c(t-i.left,e-i.top)}resize(){const t=this.getEditorArea();this.canvasCtx.canvas.width=t.x,this.canvasCtx.canvas.height=t.y,this.backgroundCtx.canvas.width=t.x,this.backgroundCtx.canvas.height=t.y,this.windowResized=!0}node(t=v.G_AND,e=this.mouse.position.x,i=this.mouse.position.y){return q.node(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,i)}input(t=v.I_SWITCH,e=this.mouse.position.x,i=this.mouse.position.y){return q.input(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,i)}output(t=v.O_LED_RED,e=this.mouse.position.x,i=this.mouse.position.y){return q.output(void 0,this.editorEnv,this.canvasCtx.canvas.width,this.canvasCtx.canvas.height,t,e,i)}line(t,e,i,n,o,r){return q.connection(void 0,this.editorEnv,t,e,i,n,o,r)}text(t,e,i,n,o){return q.text(void 0,this.editorEnv,this.canvasCtx,t,e,i,n,o)}slot(t,e,i,n,o,r,l,h){return q.slot(void 0,this.editorEnv,t,e,i,n,o,r,l,h)}remove(){return this.mouseEvents.getCollisionList().nodes.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().nodes[0]):this.mouseEvents.getCollisionList().connections.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().connections[0]):this.mouseEvents.getCollisionList().texts.length!==0?this.editorEnv.removeComponent(this.mouseEvents.getCollisionList().texts[0]):!1}}const ys=new xs("teste","editor-canvas","editor-background");ys.text("Olá mundo",500,200,"32px sans-serif");
